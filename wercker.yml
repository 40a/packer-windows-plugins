box: wercker/golang@1.2.1
build:
    steps:
        - setup-go-workspace
        - script:
            name: go get
            code: |
                go get -t ./...
        - script:
            name: go test
            code: |
                make test
        - script:
            name: Publish Coveralls
            code: goveralls -service="wercker.com" -coverprofile=profile.cov -repotoken $COVERALLS_TOKEN
        - script:
            name: gox build
            code: |
                go get -u -v github.com/mitchellh/gox
                sudo -E env PATH=$GOPATH/bin:$PATH gox -build-toolchain
                make bin
        - tcnksm/zip:
            input: pkg
            output: dist
#    after-steps:
#        - sherzberg/slack-notify:
#            subdomain: packer
#            token: $SLACK_TOKEN
#            channel: "#builds"

deploy:
  steps:
    - tcnksm/ghr:
        token: $GITHUB_TOKEN
        input: dist
        replace: true
